:css
  .amount {
    text-align: right;
    padding-right: 12px !important;
  }
  .info-col {
    padding-left: 0.25rem !important;
    padding: 0;
  }
  .ae-linked {
    color: #00a030;
  }

#main.row
  %table.table.table-striped.table-sm.table-custom
    %thead
      %tr
        %th Valuta
        %th.amount Betrag
        %th Beschreibung
        %th
    %tbody
      %tr
        %td
        %td.amount= closing_balance_eur_display
        %td Aktuelles Saldo
        %td
      - transactions.each do |tx|
        %tr
          %td= tx.value_date
          %td.amount= tx.amount_eur_display
          %td
            - if !tx.return_reason.blank?
              %div(style="color:var(--bs-orange);")
                %span.fw-ligh Retoure mit Rückgabe-Grund
                %span.fw-semibold= tx.return_reason
            %div= tx.description
            - if !tx.subject.blank?
              %div
                %span.fw-light.muted Person:
                %span= link_to(tx.subject.short_full_name_with_nickname, url_for(tx.subject))
                - if !tx.accounting_entry.blank?
                  - ae = tx.accounting_entry
                  %span.ae-linked
                    = " • Verknüpfte Buchung: #{link_to(tx.accounting_entry.link_name, url_for(tx.accounting_entry))}"
              - if tx.accounting_entry.blank?
                %div
                  - accounting_entries = tx.accounting_entries_for_subject_with_matching_amount
                  - if accounting_entries.size == 1
                    - entry = accounting_entries[0]
                    = action_button("Verknüpfe mit \"#{entry.link_name(length: 60)}\"", "#{url_for(tx)}/link_accounting_entry/#{entry.id}",
                                    :plus, method: :post, remote: false,
                                    data: { confirm: "Transaktion #{tx.id} mit Buchung \"#{entry.link_name(length: 100)}\" verknüpfen?", turbo_frame: "_top" })
                  = action_button("Erzeuge Buchung", "#{url_for(tx)}/create_accounting_entry",
                                  :plus, method: :post, remote: false,
                                  data: { confirm: "Neue Buchung anlegen?", turbo_frame: "_top" })
          %td.info-col
            %a{href: url_for(tx), target: "_blank"}
              %span.fa.fa-info-circle(aria-label="info" role="img")
      %tr
        %td
        %td.amount
          = fin_account.opening_balance_eur_display
        %td Eröffnungs-Saldo
        %td

  = standard_form(fin_account, {url: fin_account_path, method: :put, data: {turbo: false}}) do |f|
    = hidden_field_tag("fin_admin", can_fin_admin?)
    = hidden_field_tag("return_url", fin_account_return_url)
    = f.error_messages
    = form_buttons(f, cancel_url: fin_account_return_url)

    .mt-3
    = field_set_tag do
      %div.border-top.py-2
      = input_or_render_attrs(f, :short_name)
      = input_or_render_attrs(f, :account_identification)
      = input_or_render_attrs(f, :opening_balance_eur, :opening_balance_currency)
      = input_or_render_attrs(f, :opening_balance_date)
      = input_or_render_attrs(f, :description)
      %div.border-top.py-2
      = input_or_render_attrs(f, :iban)
      = input_or_render_attrs(f, :owner_name)
      = input_or_render_attrs(f, :owner_address)
      = input_or_render_attrs(f, :servicer_name)
      = input_or_render_attrs(f, :servicer_bic)
      = input_or_render_attrs(f, :servicer_address)
      %div.border-top.py-2
      = input_or_render_attrs(f, :created_at, :updated_at)
      = input_or_render_attrs(f, :status)

    = form_buttons(f, cancel_url: fin_account_return_url)
